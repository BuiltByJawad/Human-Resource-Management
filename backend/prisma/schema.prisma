generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserStatus {
  active
  inactive
  suspended
  pending
}

enum EmployeeStatus {
  active
  inactive
  terminated
}

enum AttendanceStatus {
  present
  absent
  late
  half_day
}

enum LeaveType {
  annual
  sick
  personal
  maternity
  paternity
  unpaid
}

enum PayrollStatus {
  draft
  processed
  paid
}

enum ReportType {
  employees
  attendance
  leave
  payroll
}

enum ReportFormat {
  csv
  pdf
}

enum ReportScheduleFrequency {
  daily
  weekly
  monthly
}

enum ReportRunStatus {
  queued
  running
  success
  failed
}

enum ReviewStatus {
  draft
  submitted
  approved
  acknowledged
}

enum Gender {
  male
  female
  other
}

enum MaritalStatus {
  single
  married
  divorced
  widowed
}

enum LeaveRequestStatus {
  pending
  approved
  rejected
}

enum OnboardingStatus {
  draft
  active
  completed
  archived
}

enum OnboardingTaskStatus {
  todo
  in_progress
  blocked
  done
}

model User {
  id           String     @id @default(uuid())
  email        String     @unique
  password     String
  firstName    String?
  lastName     String?
  avatarUrl    String?
  organizationId String?
  roleId       String
  departmentId String?
  status       UserStatus @default(active)
  verified     Boolean    @default(false)
  lastLogin    DateTime?
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt

  organization            Organization?         @relation(fields: [organizationId], references: [id])
  role                    Role                 @relation(fields: [roleId], references: [id])
  department              Department?          @relation(fields: [departmentId], references: [id])
  auditLogs               AuditLog[]
  passwordResetTokens     PasswordResetToken[]
  invites                 UserInvite[]
  complianceLogs          ComplianceLog[]
  onboardingAssignedTasks OnboardingTask[]     @relation("OnboardingTaskAssignee")

  // Backlink to Employee (Employee.userId)
  employee Employee?
  notifications Notification[]
  payrollPaidRecords PayrollRecord[] @relation("PayrollPaidBy")
  scheduledReportsCreated ScheduledReport[]
  scheduledReportRecipients ScheduledReportRecipient[]

  @@index([email])
  @@index([organizationId])
  @@index([roleId])
  @@index([departmentId])
}

model Role {
  id          String   @id @default(uuid())
  name        String   @unique // e.g., "HR Manager", "Super Admin"
  description String?
  isSystem    Boolean  @default(false) // System roles cannot be deleted
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  users       User[]
  permissions RolePermission[]
  employees   Employee[] // Keep for backward compatibility if needed, or migrate to User-based roles
  invites     UserInvite[]
}

model Permission {
  id          String   @id @default(uuid())
  resource    String // e.g., "employee", "leave"
  action      String // e.g., "create", "read", "approve"
  description String?
  createdAt   DateTime @default(now())

  roles RolePermission[]

  @@unique([resource, action])
}

model RolePermission {
  roleId       String
  permissionId String
  assignedAt   DateTime @default(now())

  role       Role       @relation(fields: [roleId], references: [id], onDelete: Cascade)
  permission Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)

  @@id([roleId, permissionId])
}

model CompanySettings {
  id               String   @id @default(uuid())
  organizationId   String?
  siteName         String   @default("NovaHR")
  tagline          String   @default("Workspace")
  companyName      String   @default("NovaHR Company")
  companyAddress   String   @default("123 Business Road, Tech City")
  logoUrl          String?
  faviconUrl       String?
  footerYear       Int?
  privacyPolicyText String? @db.Text
  termsOfServiceText String? @db.Text
  loginHeroTitle   String?  @default("Empower your people")
  loginHeroSubtitle String? @default("A modern HR workspace your teams will love")
  loginAccentColor String?  @default("#2563eb")
  loginBackgroundImage String?
  loginHighlights  Json?
  officeLatitude   Decimal  @default(23.8103) @db.Decimal(10, 8)
  officeLongitude  Decimal  @default(90.4125) @db.Decimal(11, 8)
  maxClockInRadius Int      @default(200)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  organization     Organization? @relation(fields: [organizationId], references: [id])

  @@unique([organizationId])
}

model UserInvite {
  id         String    @id @default(uuid())
  email      String
  roleId     String
  userId     String?
  tokenHash  String    @unique
  expiresAt  DateTime
  acceptedAt DateTime?
  createdAt  DateTime  @default(now())

  role Role  @relation(fields: [roleId], references: [id])
  user User? @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model PasswordResetToken {
  id        String    @id @default(uuid())
  userId    String
  tokenHash String    @unique
  expiresAt DateTime
  usedAt    DateTime?
  createdAt DateTime  @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model AuditLog {
  id         String   @id @default(uuid())
  userId     String
  action     String // e.g., "employee.create"
  resourceId String? // ID of the target entity
  oldValues  Json?
  newValues  Json?
  ipAddress  String?
  userAgent  String?
  createdAt  DateTime @default(now())

  user User @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([action])
}

model Department {
  id                 String   @id @default(uuid())
  name               String
  description        String?
  managerId          String?
  parentDepartmentId String?
  organizationId     String?
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  organization     Organization? @relation(fields: [organizationId], references: [id])
  manager          Employee?    @relation("DepartmentManager", fields: [managerId], references: [id])
  parentDepartment Department?  @relation("DepartmentHierarchy", fields: [parentDepartmentId], references: [id])
  subDepartments   Department[] @relation("DepartmentHierarchy")
  employees        Employee[]
  users            User[]
  jobPostings      JobPosting[]

  @@index([managerId])
  @@index([parentDepartmentId])
  @@index([organizationId])
  @@unique([organizationId, name], name: "organizationId_name")
}

// --- Existing Modules (Updated relations) ---

model Employee {
  id               String         @id @default(uuid())
  userId           String?        @unique // Link to User account
  employeeNumber   String
  firstName        String
  lastName         String
  email            String
  phoneNumber      String?
  address          String?
  dateOfBirth      DateTime?
  gender           Gender?
  maritalStatus    MaritalStatus?
  emergencyContact Json? // { name: string, relationship: string, phone: string }
  organizationId   String?
  departmentId     String?
  roleId           String? // Optional: Can inherit from User or be specific
  managerId        String?
  hireDate         DateTime
  salary           Decimal        @db.Decimal(10, 2)
  status           EmployeeStatus @default(active)
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt

  organization        Organization?        @relation(fields: [organizationId], references: [id])
  user                 User?               @relation(fields: [userId], references: [id])
  department           Department?         @relation(fields: [departmentId], references: [id])
  role                 Role?               @relation(fields: [roleId], references: [id])
  manager              Employee?           @relation("EmployeeManager", fields: [managerId], references: [id])
  subordinates         Employee[]          @relation("EmployeeManager")
  managedDepartments   Department[]        @relation("DepartmentManager")
  approvedLeaves       LeaveRequest[]      @relation("LeaveApprover")
  conductedReviews     PerformanceReview[] @relation("PerformanceReviewer")
  attendance           Attendance[]
  leaveRequests        LeaveRequest[]
  payrollRecords       PayrollRecord[]
  payrollOverrides     PayrollOverride[]
  performanceReviews   PerformanceReview[]
  documents            Document[]
  complianceLogs       ComplianceLog[]
  assetAssignments     AssetAssignment[]
  employeeDocuments    EmployeeDocument[]
  emergencyContacts    EmergencyContact[]
  onboarding           OnboardingProcess?
  offboarding          OffboardingProcess?
  benefits             EmployeeBenefit[]
  expenses             ExpenseClaim[]
  timeEntries          TimeEntry[]
  shifts               Shift[]
  sentSwapRequests     ShiftSwapRequest[]  @relation("SwapRequestor")
  receivedSwapRequests ShiftSwapRequest[]  @relation("SwapTarget")
  training             EmployeeTraining[]
  goals                PerformanceGoal[]

  @@index([organizationId])
  @@index([departmentId])
  @@index([managerId])
  @@index([userId])
  @@unique([organizationId, email], name: "organizationId_email")
  @@unique([organizationId, employeeNumber], name: "organizationId_employeeNumber")
}

//--- removed duplicate onboarding definitions (canonical models defined above) ---

model Attendance {
  id            String           @id @default(uuid())
  employeeId    String
  checkIn       DateTime
  checkOut      DateTime?
  workHours     Decimal?         @db.Decimal(4, 2)
  overtimeHours Decimal?         @default(0) @db.Decimal(4, 2)
  status        AttendanceStatus @default(present)

  // Geolocation tracking
  checkInLatitude   Decimal? @db.Decimal(10, 8)
  checkInLongitude  Decimal? @db.Decimal(11, 8)
  checkOutLatitude  Decimal? @db.Decimal(10, 8)
  checkOutLongitude Decimal? @db.Decimal(11, 8)

  createdAt DateTime @default(now())

  employee Employee @relation(fields: [employeeId], references: [id])

  @@index([employeeId])
  @@index([checkIn])
}

model LeaveRequest {
  id            String             @id @default(uuid())
  employeeId    String
  approverId    String?
  leaveType     LeaveType
  startDate     DateTime
  endDate       DateTime
  daysRequested Int
  reason        String?
  status        LeaveRequestStatus @default(pending)
  createdAt     DateTime           @default(now())
  updatedAt     DateTime           @updatedAt

  employee Employee  @relation(fields: [employeeId], references: [id])
  approver Employee? @relation("LeaveApprover", fields: [approverId], references: [id])

  @@index([employeeId])
  @@index([status])
}

model PayrollRecord {
  id                  String        @id @default(uuid())
  employeeId          String
  payPeriod           String
  baseSalary          Decimal       @db.Decimal(10, 2)
  allowances          Decimal       @default(0) @db.Decimal(10, 2)
  deductions          Decimal       @default(0) @db.Decimal(10, 2)
  netSalary           Decimal       @db.Decimal(10, 2)
  allowancesBreakdown Json?
  deductionsBreakdown Json?
  attendanceSummary   Json?
  processedAt         DateTime?
  paidAt              DateTime?
  paymentMethod       String?
  paymentReference    String?
  paidByUserId        String?
  status              PayrollStatus @default(processed)
  createdAt           DateTime      @default(now())
  updatedAt           DateTime      @updatedAt

  employee Employee @relation(fields: [employeeId], references: [id])
  paidBy   User?    @relation("PayrollPaidBy", fields: [paidByUserId], references: [id])

  @@unique([employeeId, payPeriod], name: "employeeId_payPeriod")
}

model PayrollOverride {
  id         String   @id @default(uuid())
  employeeId String
  payPeriod  String
  config     Json
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  employee Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@unique([employeeId, payPeriod], name: "employeeId_payPeriod_override")
  @@index([payPeriod])
}

model ScheduledReport {
  id             String                 @id @default(uuid())
  organizationId String
  name           String
  type           ReportType
  format         ReportFormat
  frequency      ReportScheduleFrequency
  filters        Json?
  isEnabled      Boolean                @default(true)
  nextRunAt      DateTime?
  lastRunAt      DateTime?
  createdByUserId String
  createdAt      DateTime               @default(now())
  updatedAt      DateTime               @updatedAt

  organization Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  createdBy    User         @relation(fields: [createdByUserId], references: [id], onDelete: Cascade)
  recipients   ScheduledReportRecipient[]
  runs         ScheduledReportRun[]

  @@index([organizationId])
  @@index([isEnabled])
  @@index([nextRunAt])
}

model ScheduledReportRecipient {
  id                String   @id @default(uuid())
  scheduledReportId String
  userId            String
  createdAt         DateTime @default(now())

  scheduledReport ScheduledReport @relation(fields: [scheduledReportId], references: [id], onDelete: Cascade)
  user            User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([scheduledReportId, userId], name: "scheduledReportId_userId")
  @@index([userId])
}

model ScheduledReportRun {
  id                String        @id @default(uuid())
  scheduledReportId String
  status            ReportRunStatus @default(queued)
  startedAt         DateTime?
  finishedAt        DateTime?
  errorMessage      String?
  deliveredCount    Int           @default(0)
  createdAt         DateTime      @default(now())

  scheduledReport ScheduledReport @relation(fields: [scheduledReportId], references: [id], onDelete: Cascade)

  @@index([scheduledReportId])
  @@index([status])
}

model Organization {
  id          String   @id @default(uuid())
  name        String
  slug        String?  @unique
  description String?
  settings    Json?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  users          User[]
  scheduledReports ScheduledReport[]
  companySettings CompanySettings?
  departments    Department[]
  employees      Employee[]
  companyDocuments CompanyDocument[]
  complianceRules ComplianceRule[]
  assets          Asset[]
  reviewCycles    ReviewCycle[]
  performanceReviews PerformanceReview[]
}

// Employee Portal Models
model EmployeeDocument {
  id         String   @id @default(uuid())
  employeeId String
  employee   Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  type       String // "id", "contract", "certification", "personal", "tax", "other"
  name       String
  url        String
  uploadedAt DateTime @default(now())
  uploadedBy String?

  @@index([employeeId])
}

model EmergencyContact {
  id           String   @id @default(uuid())
  employeeId   String
  employee     Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  name         String
  relationship String
  phone        String
  email        String?
  isPrimary    Boolean  @default(false)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([employeeId])
}

model Document {
  id         String   @id @default(uuid())
  employeeId String
  title      String
  fileUrl    String
  category   String?
  uploadedAt DateTime @default(now())

  employee Employee @relation(fields: [employeeId], references: [id])

  @@index([employeeId])
}

model ComplianceRule {
  id          String   @id @default(uuid())
  name        String
  description String?
  type        String // e.g., "max_hours_per_week", "min_rest_period"
  threshold   Int // e.g., 48 (hours), 11 (hours)
  isActive    Boolean  @default(true)
  organizationId String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  logs ComplianceLog[]
  organization Organization @relation(fields: [organizationId], references: [id])

  @@index([organizationId])
  @@unique([organizationId, name], name: "organizationId_name")
}

model ComplianceLog {
  id            String   @id @default(uuid())
  ruleId        String
  employeeId    String
  violationDate DateTime
  details       String?
  status        String   @default("open") // open, resolved, ignored
  createdAt     DateTime @default(now())

  rule     ComplianceRule @relation(fields: [ruleId], references: [id])
  employee Employee       @relation(fields: [employeeId], references: [id])
  User     User?          @relation(fields: [userId], references: [id])
  userId   String?

  @@index([ruleId])
  @@index([employeeId])
}

enum JobStatus {
  open
  closed
  draft
}

enum ApplicantStatus {
  applied
  screening
  interview
  offer
  hired
  rejected
}

model JobPosting {
  id           String    @id @default(uuid())
  title        String
  departmentId String
  description  String?
  requirements String?
  status       JobStatus @default(open)
  postedDate   DateTime  @default(now())
  closingDate  DateTime?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  department Department  @relation(fields: [departmentId], references: [id])
  applicants Applicant[]

  @@index([departmentId])
}

model Applicant {
  id          String          @id @default(uuid())
  jobId       String
  firstName   String
  lastName    String
  email       String
  phone       String?
  resumeUrl   String?
  status      ApplicantStatus @default(applied)
  appliedDate DateTime        @default(now())
  notes       String?
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt

  job JobPosting @relation(fields: [jobId], references: [id])

  @@index([jobId])
  @@index([email])
}

model Asset {
  id            String    @id @default(uuid())
  name          String
  description   String?
  serialNumber  String
  type          String // Laptop, Monitor, License, etc.
  status        String    @default("available") // available, assigned, maintenance, retired
  purchaseDate  DateTime
  purchasePrice Decimal?  @db.Decimal(10, 2)
  vendor        String?
  warrantyEnd   DateTime?
  organizationId String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  assignments AssetAssignment[]
  maintenance MaintenanceLog[]

  organization Organization @relation(fields: [organizationId], references: [id])

  @@index([organizationId])
  @@unique([organizationId, serialNumber], name: "organizationId_serialNumber")
}

model AssetAssignment {
  id           String    @id @default(uuid())
  assetId      String
  employeeId   String
  assignedDate DateTime  @default(now())
  returnedDate DateTime?
  notes        String?

  asset    Asset    @relation(fields: [assetId], references: [id])
  employee Employee @relation(fields: [employeeId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model MaintenanceLog {
  id          String   @id @default(uuid())
  assetId     String
  description String
  cost        Decimal? @db.Decimal(10, 2)
  date        DateTime @default(now())
  performedBy String? // Vendor or internal IT

  asset Asset @relation(fields: [assetId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ReviewCycle {
  id        String   @id @default(uuid())
  title     String // e.g., "Q1 2024 Performance Review"
  organizationId String
  startDate DateTime
  endDate   DateTime
  status    String   @default("active") // active, closed, archived
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  organization Organization @relation(fields: [organizationId], references: [id])
  reviews PerformanceReview[]

  @@index([organizationId])
}

model PerformanceReview {
  id         String       @id @default(uuid())
  organizationId String
  employeeId String
  reviewerId String
  cycleId    String
  type       String // self, manager, peer
  ratings    Json // Key-value pairs of criteria and scores
  comments   String?
  status     ReviewStatus @default(draft)
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @updatedAt

  organization Organization @relation(fields: [organizationId], references: [id])
  employee Employee    @relation(fields: [employeeId], references: [id])
  reviewer Employee    @relation("PerformanceReviewer", fields: [reviewerId], references: [id])
  cycle    ReviewCycle @relation(fields: [cycleId], references: [id])

  @@index([organizationId])
  @@index([employeeId])
  @@index([reviewerId])
  @@index([cycleId])
}

model OnboardingProcess {
  id          String           @id @default(uuid())
  employeeId  String           @unique
  status      OnboardingStatus @default(active)
  startDate   DateTime?
  dueDate     DateTime?
  completedAt DateTime?
  createdBy   String?
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt

  employee Employee         @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  tasks    OnboardingTask[]

  @@index([employeeId])
}

model OnboardingTask {
  id             String               @id @default(uuid())
  processId      String
  title          String
  description    String?
  assigneeUserId String?
  dueDate        DateTime?
  status         OnboardingTaskStatus @default(todo)
  completedAt    DateTime?
  notes          String?
  order          Int?
  createdAt      DateTime             @default(now())
  updatedAt      DateTime             @updatedAt

  process  OnboardingProcess @relation(fields: [processId], references: [id], onDelete: Cascade)
  assignee User?             @relation("OnboardingTaskAssignee", fields: [assigneeUserId], references: [id])

  @@index([processId])
  @@index([assigneeUserId])
}

model OffboardingProcess {
  id         String            @id @default(uuid())
  employeeId String            @unique
  employee   Employee          @relation(fields: [employeeId], references: [id])
  reason     String // "Resignation", "Termination", "Contract End", "Retirement"
  notes      String?
  exitDate   DateTime
  status     String            @default("pending") // pending, in_progress, completed
  tasks      OffboardingTask[]
  createdAt  DateTime          @default(now())
  updatedAt  DateTime          @updatedAt
}

model OffboardingTask {
  id           String             @id @default(uuid())
  processId    String
  process      OffboardingProcess @relation(fields: [processId], references: [id])
  title        String
  description  String?
  status       String             @default("pending") // pending, completed
  assigneeRole String? // "HR", "Manager", "IT"
  completedAt  DateTime?
  completedBy  String?
}

model BenefitPlan {
  id             String            @id @default(uuid())
  name           String
  type           String // "Health", "Dental", "Vision", "Retirement", "Other"
  description    String?
  provider       String?
  costToEmployee Decimal           @default(0.00) @db.Decimal(10, 2) // Monthly deduction
  costToCompany  Decimal           @default(0.00) @db.Decimal(10, 2)
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt
  enrollments    EmployeeBenefit[]
}

model EmployeeBenefit {
  id                String      @id @default(uuid())
  employeeId        String
  employee          Employee    @relation(fields: [employeeId], references: [id])
  benefitPlanId     String
  benefitPlan       BenefitPlan @relation(fields: [benefitPlanId], references: [id])
  enrollmentDate    DateTime    @default(now())
  coverageStartDate DateTime
  coverageEndDate   DateTime? // Null if active
  status            String      @default("active") // active, cancelled
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt

  @@unique([employeeId, benefitPlanId])
}

model ExpenseClaim {
  id              String   @id @default(uuid())
  employeeId      String
  employee        Employee @relation(fields: [employeeId], references: [id])
  amount          Decimal  @db.Decimal(10, 2)
  currency        String   @default("USD")
  category        String // "Travel", "Meals", "Equipment", "Training", "Other"
  date            DateTime
  description     String?
  receiptUrl      String?
  status          String   @default("pending") // pending, approved, rejected, reimbursed
  approvedBy      String? // Manager/Admin ID
  rejectionReason String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model Project {
  id          String      @id @default(uuid())
  name        String
  description String?
  client      String?
  status      String      @default("active") // active, completed, archived
  startDate   DateTime
  endDate     DateTime?
  timeEntries TimeEntry[]
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
}

model TimeEntry {
  id          String    @id @default(uuid())
  employeeId  String
  employee    Employee  @relation(fields: [employeeId], references: [id])
  projectId   String?
  project     Project?  @relation(fields: [projectId], references: [id])
  date        DateTime
  startTime   DateTime
  endTime     DateTime? // Null if currently clocked in
  duration    Int? // In minutes, calculated on completion
  description String?
  type        String    @default("work") // work, break, meeting
  status      String    @default("pending") // pending, approved
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model Shift {
  id         String   @id @default(uuid())
  employeeId String
  employee   Employee @relation(fields: [employeeId], references: [id])
  startTime  DateTime
  endTime    DateTime
  type       String   @default("Regular") // "Regular", "Overtime", "OnCall"
  location   String? // "Office", "Remote"
  status     String   @default("scheduled") // scheduled, completed, cancelled
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  swapRequests ShiftSwapRequest[]
}

model ShiftSwapRequest {
  id          String    @id @default(uuid())
  shiftId     String
  shift       Shift     @relation(fields: [shiftId], references: [id])
  requestorId String
  requestor   Employee  @relation("SwapRequestor", fields: [requestorId], references: [id])
  targetId    String? // Optional: specific employee to swap with
  target      Employee? @relation("SwapTarget", fields: [targetId], references: [id])
  status      String    @default("pending") // pending, approved, rejected
  reason      String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model CompanyDocument {
  id          String   @id @default(uuid())
  title       String
  description String?
  category    String // "HR Policy", "IT Policy", "Handbook", "Form", "Other"
  fileUrl     String
  type        String // "PDF", "DOCX", etc.
  isVisible   Boolean  @default(true)
  uploadedBy  String // Admin User ID
  organizationId String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  organization Organization? @relation(fields: [organizationId], references: [id])

  @@index([organizationId])
}

model TrainingCourse {
  id          String   @id @default(uuid())
  title       String
  description String?
  contentUrl  String? // Link to video, PDF, or slide deck
  duration    Int? // Estimated distinct in minutes
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  assignments EmployeeTraining[]
}

model EmployeeTraining {
  id             String         @id @default(uuid())
  employeeId     String
  employee       Employee       @relation(fields: [employeeId], references: [id])
  courseId       String
  course         TrainingCourse @relation(fields: [courseId], references: [id])
  status         String         @default("assigned") // assigned, in-progress, completed
  progress       Int            @default(0) // Percentage 0-100
  assignedDate   DateTime       @default(now())
  completionDate DateTime?

  @@unique([employeeId, courseId])
}

model PerformanceGoal {
  id          String    @id @default(uuid())
  employeeId  String
  employee    Employee  @relation(fields: [employeeId], references: [id])
  title       String
  description String?
  status      String    @default("in-progress") // not-started, in-progress, completed, cancelled
  startDate   DateTime  @default(now())
  endDate     DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  keyResults KeyResult[]
}

model Notification {
  id        String   @id @default(uuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  title     String
  message   String?
  type      String? // e.g., "leave", "system", "payroll"
  link      String?
  readAt    DateTime?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId, readAt])
}

model KeyResult {
  id           String          @id @default(uuid())
  goalId       String
  goal         PerformanceGoal @relation(fields: [goalId], references: [id])
  description  String
  targetValue  Int             @default(100) // e.g., 100% or 10 sales
  currentValue Int             @default(0)
  unit         String          @default("percentage") // percentage, count, currency
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt
}
